# SeaSketch MPA Analysis Module

This geoprocessing module provides analysis capabilities for Marine Protected Areas (MPAs) in SeaSketch. It includes functionality for analyzing fishing zone overlaps and habitat impacts within MPA boundaries.

## Features

- **Basic MPA Metrics**: Calculate total area and basic statistics for MPA sketches
- **Fishing Zone Analysis**: Analyze overlaps between MPAs and different fishing zones
- **Habitat Impact Assessment**: Evaluate the impact of MPAs on sensitive marine habitats

## Prerequisites

- Node.js (v14 or later)
- npm or yarn
- SeaSketch project with appropriate layers configured

## Installation

1. Clone this repository
2. Install dependencies:
   ```bash
   npm install
   ```
3. Build the project:
   ```bash
   npm run build
   ```

## Configuration

1. Update the `src/config.ts` file with your SeaSketch layer IDs:
   ```typescript
   export const CONFIG = {
     LAYER_IDS: {
       FISHING_ZONES: 'YOUR_FISHING_ZONES_LAYER_ID',
       HABITATS: 'YOUR_HABITATS_LAYER_ID'
     }
   };
   ```

2. Ensure your SeaSketch layers have the following properties:
   - **Fishing Zones Layer**:
     - `id`: Unique identifier for the fishing zone
     - `name`: Display name of the fishing zone
     - `type`: Type of fishing zone (e.g., 'commercial', 'recreational', 'protected')
   
   - **Habitats Layer**:
     - `id`: Unique identifier for the habitat
     - `name`: Display name of the habitat
     - `sensitivity`: Numeric value (1-5) indicating habitat sensitivity

## Deployment

### Option 1: GitHub Pages (Recommended for CORS compatibility)

We've created a `docs` directory containing the necessary files for GitHub Pages deployment, which avoids CORS issues:

1. Create a GitHub repository for your project

2. Push your project to GitHub:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/YOUR-USERNAME/YOUR-REPO.git
   git push -u origin main
   ```

3. In your GitHub repository settings:
   - Go to "Pages"
   - Under "Source", select "Deploy from a branch"
   - Select the branch "main" and folder "/docs"
   - Click "Save"

4. Wait a few minutes for GitHub Pages to deploy your site
   - The URL will be `https://YOUR-USERNAME.github.io/YOUR-REPO`

5. In SeaSketch, use your GitHub Pages URL to configure the geoprocessing service

### Option 2: Vercel Deployment

1. Build the project:
   ```powershell
   npm run build
   ```

2. Deploy to Vercel:
   ```powershell
   vercel --prod
   ```

3. Note: You may need to manually configure CORS headers in the Vercel dashboard

### Option 3: Traditional SeaSketch Upload

1. Create a ZIP file named `deploy-package.zip` containing:
   - The entire `dist` folder
   - `package.json`
   - `package-lock.json`
   - `tsconfig.json`

   ```powershell
   Compress-Archive -Path dist, package.json, package-lock.json, tsconfig.json -DestinationPath deploy-package.zip -Force
   ```

2. In your SeaSketch admin panel:
   - Go to "Geoprocessing" > "Services"
   - Click "Add Service"
   - Upload the `deploy-package.zip` file
   - Set the handler to `default`
   - Save the service

## Usage in SeaSketch

1. **Create a New Report Template**:
   - Go to "Reports" > "Templates"
   - Create a new template
   - Add sections to display the metrics generated by this module

2. **Available Metrics**:
   - `fishing-zone-total-area`: Total area of the MPA sketch
   - `fishing-zone-{id}-overlap-area`: Area of overlap with a specific fishing zone
   - `fishing-zone-{id}-overlap-percent`: Percentage of MPA overlapping with a fishing zone
   - `habitat-total-area`: Total area of the MPA sketch
   - `habitat-{id}-impact`: Impact score for a specific habitat
   - `habitat-{id}-coverage`: Percentage of a specific habitat covered by the MPA

## Development

- Run tests: `npm test`
- Lint code: `npm run lint`
- Format code: `npm run format`

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
